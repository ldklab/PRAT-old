666,669c666,669
<     #####:  664:	if(config->persistence){
<     #####:  665:		if(!config->persistence_file){
<     #####:  666:			config->persistence_file = mosquitto__strdup("mosquitto.db");
<     #####:  667:			if(!config->persistence_file) return MOSQ_ERR_NOMEM;
---
>         -:  664:	if(config->persistence){
>         -:  665:		if(!config->persistence_file){
>         -:  666:			config->persistence_file = mosquitto__strdup("mosquitto.db");
>         -:  667:			if(!config->persistence_file) return MOSQ_ERR_NOMEM;
671,676c671,676
<     #####:  669:		mosquitto__free(config->persistence_filepath);
<     #####:  670:		if(config->persistence_location && strlen(config->persistence_location)){
<     #####:  671:			len = strlen(config->persistence_location) + strlen(config->persistence_file) + 1;
<     #####:  672:			config->persistence_filepath = mosquitto__malloc(len);
<     #####:  673:			if(!config->persistence_filepath) return MOSQ_ERR_NOMEM;
<     #####:  674:			snprintf(config->persistence_filepath, len, "%s%s", config->persistence_location, config->persistence_file);
---
>         -:  669:		mosquitto__free(config->persistence_filepath);
>         -:  670:		if(config->persistence_location && strlen(config->persistence_location)){
>         -:  671:			len = strlen(config->persistence_location) + strlen(config->persistence_file) + 1;
>         -:  672:			config->persistence_filepath = mosquitto__malloc(len);
>         -:  673:			if(!config->persistence_filepath) return MOSQ_ERR_NOMEM;
>         -:  674:			snprintf(config->persistence_filepath, len, "%s%s", config->persistence_location, config->persistence_file);
678,679c678,679
<     #####:  676:			config->persistence_filepath = mosquitto__strdup(config->persistence_file);
<     #####:  677:			if(!config->persistence_filepath) return MOSQ_ERR_NOMEM;
---
>         -:  676:			config->persistence_filepath = mosquitto__strdup(config->persistence_file);
>         -:  677:			if(!config->persistence_filepath) return MOSQ_ERR_NOMEM;
