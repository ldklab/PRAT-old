        -:    0:Source:/home/ryan/git/OpenDDS-debloat/ACE_wrappers/ace/Countdown_Time_T.cpp
        -:    0:Programs:51
        -:    1:// $Id: Countdown_Time_T.cpp 2179 2013-05-28 22:16:51Z mesnierp $
        -:    2:
        -:    3:#ifndef ACE_COUNTDOWN_TIME_T_CPP
        -:    4:#define ACE_COUNTDOWN_TIME_T_CPP
        -:    5:
        -:    6:#include "ace/Countdown_Time_T.h"
        -:    7:
        -:    8:#if !defined (__ACE_INLINE__)
        -:    9:#include "ace/Countdown_Time_T.inl"
        -:   10:#endif /* __ACE_INLINE__ */
        -:   11:
        -:   12:ACE_BEGIN_VERSIONED_NAMESPACE_DECL
        -:   13:
        -:   14:template <typename TIME_POLICY> ACE_INLINE
    #####:   15:ACE_Countdown_Time_T<TIME_POLICY>::ACE_Countdown_Time_T (ACE_Time_Value *max_wait_time,
        -:   16:                                                         TIME_POLICY const & time_policy)
        -:   17:  : time_policy_ (time_policy),
        -:   18:    max_wait_time_ (max_wait_time),
        -:   19:    max_wait_value_ (ACE_Time_Value::zero),
    #####:   20:    stopped_ (false)
        -:   21:{
    #####:   22:  this->start ();
    #####:   23:}
        -:   24:
        -:   25:template <typename TIME_POLICY> ACE_INLINE
    #####:   26:ACE_Countdown_Time_T<TIME_POLICY>::~ACE_Countdown_Time_T (void)
        -:   27:{
    #####:   28:  this->stop ();
    #####:   29:}
        -:   30:
        -:   31:template <typename TIME_POLICY> ACE_INLINE void
    #####:   32:ACE_Countdown_Time_T<TIME_POLICY>::start (void)
        -:   33:{
    #####:   34:  if (this->max_wait_time_ != 0)
        -:   35:    {
    #####:   36:      this->max_wait_value_ = *this->max_wait_time_;
    #####:   37:      this->start_time_ = this->time_policy_ ();
    #####:   38:      this->stopped_ = false;
        -:   39:    }
    #####:   40:}
        -:   41:
        -:   42:template <typename TIME_POLICY> ACE_INLINE void
    #####:   43:ACE_Countdown_Time_T<TIME_POLICY>::stop (void)
        -:   44:{
    #####:   45:  if (this->max_wait_time_ != 0 && !this->stopped_)
        -:   46:    {
    #####:   47:      ACE_Time_Value const elapsed_time =
        -:   48:          this->time_policy_ () - this->start_time_;
        -:   49:
    #####:   50:      if (elapsed_time >= ACE_Time_Value::zero &&
    #####:   51:          this->max_wait_value_ > elapsed_time)
        -:   52:        {
    #####:   53:          *this->max_wait_time_ = this->max_wait_value_ - elapsed_time;
        -:   54:        }
        -:   55:      else
        -:   56:        {
        -:   57:          // Used all of timeout.
    #####:   58:          *this->max_wait_time_ = ACE_Time_Value::zero;
        -:   59:          // errno = ETIME;
        -:   60:        }
    #####:   61:      this->stopped_ = true;
        -:   62:    }
    #####:   63:}
        -:   64:
        -:   65:ACE_END_VERSIONED_NAMESPACE_DECL
        -:   66:
        -:   67:#endif /* ACE_COUNTDOWN_TIME_T_CPP */
