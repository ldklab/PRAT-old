        -:    0:Source:/home/ryan/git/OpenDDS-debloat/ACE_wrappers/ace/OS_NS_sys_select.inl
        -:    0:Programs:51
        -:    1:// -*- C++ -*-
        -:    2://
        -:    3:// $Id: OS_NS_sys_select.inl 2179 2013-05-28 22:16:51Z mesnierp $
        -:    4:
        -:    5:#include "ace/OS_NS_errno.h"
        -:    6:#include "ace/OS_NS_macros.h"
        -:    7:#include "ace/Time_Value.h"
        -:    8:
        -:    9:ACE_BEGIN_VERSIONED_NAMESPACE_DECL
        -:   10:
        -:   11:// It would be really cool to add another version of select that would
        -:   12:// function like the one we're defending against below!
        -:   13:ACE_INLINE int
    #####:   14:ACE_OS::select (int width,
        -:   15:                fd_set *rfds, fd_set *wfds, fd_set *efds,
        -:   16:                const ACE_Time_Value *timeout)
        -:   17:{
        -:   18:  ACE_OS_TRACE ("ACE_OS::select");
        -:   19:#if defined (ACE_HAS_NONCONST_SELECT_TIMEVAL)
        -:   20:  // We must defend against non-conformity!
        -:   21:  timeval copy;
    #####:   22:  timeval *timep = 0;
        -:   23:
    #####:   24:  if (timeout != 0)
        -:   25:    {
    #####:   26:      copy = *timeout;
    #####:   27:      timep = &copy;
        -:   28:    }
        -:   29:  else
    #####:   30:    timep = 0;
        -:   31:#else
        -:   32:  const timeval *timep = (timeout == 0 ? (const timeval *)0 : *timeout);
        -:   33:#endif /* ACE_HAS_NONCONST_SELECT_TIMEVAL */
        -:   34:#if defined (ACE_LACKS_SELECT)
        -:   35:  ACE_UNUSED_ARG (width);
        -:   36:  ACE_UNUSED_ARG (rfds);
        -:   37:  ACE_UNUSED_ARG (wfds);
        -:   38:  ACE_UNUSED_ARG (efds);
        -:   39:  ACE_UNUSED_ARG (timeout);
        -:   40:  ACE_NOTSUP_RETURN (-1);
        -:   41:#else
    #####:   42:  ACE_SOCKCALL_RETURN (::select (width, rfds, wfds, efds, timep),
        -:   43:                       int, -1);
        -:   44:#endif
        -:   45:}
        -:   46:
        -:   47:ACE_INLINE int
        -:   48:ACE_OS::select (int width,
        -:   49:                fd_set *rfds, fd_set *wfds, fd_set *efds,
        -:   50:                const ACE_Time_Value &timeout)
        -:   51:{
        -:   52:  ACE_OS_TRACE ("ACE_OS::select");
        -:   53:#if defined (ACE_HAS_NONCONST_SELECT_TIMEVAL)
        -:   54:# define ___ACE_TIMEOUT &copy
        -:   55:  timeval copy = timeout;
        -:   56:#else
        -:   57:# define ___ACE_TIMEOUT timep
        -:   58:  const timeval *timep = timeout;
        -:   59:#endif /* ACE_HAS_NONCONST_SELECT_TIMEVAL */
        -:   60:#if defined (ACE_LACKS_SELECT)
        -:   61:  ACE_UNUSED_ARG (width);
        -:   62:  ACE_UNUSED_ARG (rfds);
        -:   63:  ACE_UNUSED_ARG (wfds);
        -:   64:  ACE_UNUSED_ARG (efds);
        -:   65:  ACE_UNUSED_ARG (timeout);
        -:   66:  ACE_NOTSUP_RETURN (-1);
        -:   67:#else
        -:   68:  ACE_SOCKCALL_RETURN (::select (width, rfds, wfds, efds, ___ACE_TIMEOUT),
        -:   69:                       int, -1);
        -:   70:#endif
        -:   71:#undef ___ACE_TIMEOUT
        -:   72:}
        -:   73:
        -:   74:ACE_END_VERSIONED_NAMESPACE_DECL
